<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Nachos: FileSystem Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>FileSystem Class Reference</h1><!-- doxytag: class="FileSystem" -->Defines the Nachos file system.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="filesys_8h-source.html">filesys.h</a>&gt;</code>
<p>
<a href="classFileSystem-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#a0">FileSystem</a> (bool format)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#a1">Create</a> (char *name, int initialSize)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classOpenFile.html">OpenFile</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#a2">Open</a> (char *name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#a3">Remove</a> (char *name)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#a4">List</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#a5">Print</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classOpenFile.html">OpenFile</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#a6">GetFreeMapFile</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classOpenFile.html">OpenFile</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#a7">GetDirFile</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#a8">Mkdir</a> (char *)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#a9">Rmdir</a> (char *)</td></tr>

<tr><td colspan="2"><br><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classOpenFile.html">OpenFile</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#r0">freeMapFile</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classOpenFile.html">OpenFile</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFileSystem.html#r1">directoryFile</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Defines the Nachos file system. 
<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0"></a><!-- doxytag: member="FileSystem::FileSystem" ref="a0" args="(bool format)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">FileSystem::FileSystem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">bool&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>format</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialize the file system. Must be called *after* "synchDisk" has been initialized.     </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a1"></a><!-- doxytag: member="FileSystem::Create" ref="a1" args="(char *name, int initialSize)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int FileSystem::Create           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>initialSize</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create a file (UNIX creat). 
<p>
Create a file in the Nachos file system (similar to UNIX create). Since we can't increase the size of files dynamically, we have to give Create the initial size of the file.<p>
The steps to create a file are: Make sure the file doesn't already exist Allocate a sector for the file header Allocate space on disk for the data blocks for the file Add the name to the directory Store the new file header on disk Flush the changes to the bitmap and the directory back to disk<p>
Create fails if: file is already in directory no free space for file header no free entry for file in directory no free space for data blocks for the file<p>
Note that this implementation assumes there is no concurrent access to the file system!<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>is the name of file to be created (NOT MODIFIED) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>initialSize</em>&nbsp;</td><td>is the size of file to be created </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>NoError if everything goes ok, otherwise, return an error code as define in <a class="el" href="msgerror_8h.html">msgerror.h</a></dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a7"></a><!-- doxytag: member="FileSystem::GetDirFile" ref="a7" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="classOpenFile.html">OpenFile</a> * FileSystem::GetDirFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the root directory. 
<p>
return the base directory file (used by the open file table).    </td>
  </tr>
</table>
<a class="anchor" name="a6"></a><!-- doxytag: member="FileSystem::GetFreeMapFile" ref="a6" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="classOpenFile.html">OpenFile</a> * FileSystem::GetFreeMapFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the free map table. 
<p>
return the free map file (used by the open file table).    </td>
  </tr>
</table>
<a class="anchor" name="a4"></a><!-- doxytag: member="FileSystem::List" ref="a4" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void FileSystem::List           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<a class="el" href="classList.html">List</a> all the files in the file system. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8"></a><!-- doxytag: member="FileSystem::Mkdir" ref="a8" args="(char *)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int FileSystem::Mkdir           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dirname</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create a new directory. 
<p>
Create a directory in the Nachos file system (similar to UNIX create). A directory is a file containing a table of directory entries.<p>
The steps to create a dirctory are: Make sure the name is valid and does not exist Create a file containing the directory entries mkdir fails if: dir already exists no free space for file header no free entry for dir in directory no free space for data blocks for the file<p>
Note that this implementation assumes there is no concurrent access to the file system!<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>is the name of directory to be created (NOT MODIFIED) </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>NoError if everything goes ok, an error code otherwise (see <a class="el" href="msgerror_8h.html">msgerror.h</a>)</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a2"></a><!-- doxytag: member="FileSystem::Open" ref="a2" args="(char *name)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="classOpenFile.html">OpenFile</a> * FileSystem::Open           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>name</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Open a file (UNIX open). 
<p>
Open a file for reading and writing. To open a file: Find the location of the file's header, using the directory Bring the header into memory<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>the text name of the file to be opened (NOT MODIFIED)</td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a5"></a><!-- doxytag: member="FileSystem::Print" ref="a5" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void FileSystem::Print           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<a class="el" href="classList.html">List</a> all the files and their contents. 
<p>
Print everything about the file system: the contents of the bitmap the contents of the directory for each file in the directory, the contents of the file header the data in the file    </td>
  </tr>
</table>
<a class="anchor" name="a3"></a><!-- doxytag: member="FileSystem::Remove" ref="a3" args="(char *name)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int FileSystem::Remove           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>name</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Delete a file (UNIX unlink). 
<p>
Delete a file from the file system. This requires: Remove it from the directory Delete the space for its header Delete the space for its data blocks Write changes to directory, bitmap back to disk<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>the text name of the file to be removed (NOT MODIFIED) </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>NoError if the file was deleted, else an error code as defined in <a class="el" href="msgerror_8h.html">msgerror.h</a></dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a9"></a><!-- doxytag: member="FileSystem::Rmdir" ref="a9" args="(char *)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int FileSystem::Rmdir           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dirname</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Delete a directory. 
<p>
Delete a directory from the file system. This requires: check the name is valid check the directory is empty Remove it from its directory Delete the space for its header Delete the space for its data blocks Write changes to directory, bitmap back to disk<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>namedir</em>&nbsp;</td><td>the text name of the directory to be removed (NOT MODIFIED) </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>NoError if the directory was deleted, else an error code (see <a class="el" href="msgerror_8h.html">msgerror.h</a>)</dd></dl>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="r1"></a><!-- doxytag: member="FileSystem::directoryFile" ref="r1" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="classOpenFile.html">OpenFile</a>* <a class="el" href="classFileSystem.html#r1">FileSystem::directoryFile</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
"Root" directory -- list of file names, represented as a file    </td>
  </tr>
</table>
<a class="anchor" name="r0"></a><!-- doxytag: member="FileSystem::freeMapFile" ref="r0" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="classOpenFile.html">OpenFile</a>* <a class="el" href="classFileSystem.html#r0">FileSystem::freeMapFile</a><code> [private]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Bit map of free disk blocks, represented as a file    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li>filesys/<a class="el" href="filesys_8h-source.html">filesys.h</a><li>filesys/<a class="el" href="filesys_8cc.html">filesys.cc</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Mon Oct 17 19:44:18 2005 for Nachos by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
