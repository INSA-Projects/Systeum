<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Nachos: filesys/filesys.cc File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000001.html">filesys</a></div>
<h1>filesys.cc File Reference</h1>Routines to manage the overall operation of the file system. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="copyright_8h-source.html">copyright.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="msgerror_8h-source.html">msgerror.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="disk_8h-source.html">disk.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="config_8h-source.html">config.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="bitmap_8h-source.html">bitmap.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="directory_8h-source.html">directory.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="filehdr_8h-source.html">filehdr.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="filesys_8h-source.html">filesys.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="system_8h-source.html">system.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="oftable_8h-source.html">oftable.h</a>&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="filesys_8cc.html#a0">FreeMapSector</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="filesys_8cc.html#a1">DirectorySector</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="filesys_8cc.html#a2">decompname</a> (const char *orig_path, char *head, char *tail)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="filesys_8cc.html#a3">FindDir</a> (char *name)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Routines to manage the overall operation of the file system. 
<p>
Implements routines to map from textual file names to files.<p>
Each file in the file system has:<ul>
<li>A file header, stored in a sector on disk (the size of the file header data structure is arranged to be precisely the size of 1 disk sector)</li><li>A number of data blocks</li><li>An entry in the file system directory</li></ul>
<p>
The file system consists of several data structures:<ul>
<li>A bitmap of free disk sectors (cf. <a class="el" href="bitmap_8h.html">bitmap.h</a>)</li><li>A directory of file names and file headers</li></ul>
<p>
Both the bitmap and the directory are represented as normal files. Their file headers are located in specific sectors (sector 0 and sector 1), so that the file system can find them on bootup.<p>
The file system assumes that the bitmap and directory files are kept "open" continuously while Nachos is running.<p>
For those operations (such as Create, Remove) that modify the directory and/or bitmap, if the operation succeeds, the changes are written immediately back to disk (the two files are kept open during all this time). If the operation fails, and we have modified part of the directory and/or bitmap, we simply discard the changed version, without writing it back to disk.<p>
Our implementation at this point has the following restrictions:<p>
<ul>
<li>there is no synchronization for concurrent accesses</li><li>there is no hierarchical directory structure, and only a limited number of files can be added to the system</li><li>there is no attempt to make the system robust to failures (if Nachos exits in the middle of an operation that modifies the file system, it may corrupt the disk)</li></ul>
<p>
Points 1 and 2 are removed in the file system assignment<p>
Copyright (c) 1992-1993 The Regents of the University of California. All rights reserved. See <a class="el" href="copyright_8h.html">copyright.h</a> for copyright notice and limitation of liability and disclaimer of warranty provisions.<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1"></a><!-- doxytag: member="filesys.cc::DirectorySector" ref="a1" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define DirectorySector&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a0"></a><!-- doxytag: member="filesys.cc::FreeMapSector" ref="a0" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define FreeMapSector&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sectors containing the file headers for the bitmap of free sectors, and the directory of files. These file headers are placed in well-known sectors, so that they can be located on boot-up.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2"></a><!-- doxytag: member="filesys.cc::decompname" ref="a2" args="(const char *orig_path, char *head, char *tail)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool decompname           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>orig_path</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>head</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>tail</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
this function returns the name of the first directory in the path given in argument, as well as the remainder of the path if we call decompname("/bin/new/halt",head,tail), we get "bin" in head and "/new/halt" in tail<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>orig_path</em>&nbsp;</td><td>: the pathname we want to decompose </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>head</em>&nbsp;</td><td>: the first element in the path (for instance bin) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tail</em>&nbsp;</td><td>: the remainder of the string (for instance /new/halt) </td></tr>
  </table>
</dl>
<dl compact><dt><b>Note:</b></dt><dd>tail MAY point to the address of orig_path, in which case orig_path is altered </dd></dl>
<dl compact><dt><b>Returns:</b></dt><dd>true if everything goes ok, otherwise, return false. </dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>head and tail MUST be large enough to contain the resulting strings</dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a3"></a><!-- doxytag: member="filesys.cc::FindDir" ref="a3" args="(char *name)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int FindDir           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>name</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
this function takes a complete pathname and return the disc sector of the fileheader of the directory.<p>
IMPORTANT WARNING : name is modified : after the execution name contains only the name of the file (e.g. if we called FindDir("/bin/halt") then name is "halt" after the execution, the function returns the sector number of the directory "/bin").<p>
Actually, this function does not support complete pathnames This is one of the objectives of the file system assignment<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>is the complete name (relatively to the root directory). The contents of this string will be modified! </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the sector number of the directory, or -1 in case of an error</dd></dl>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Mon Oct 17 19:44:17 2005 for Nachos by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
